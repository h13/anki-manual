<!DOCTYPE HTML>
<html lang="en" class="light sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Sync Server - Anki Manual</title>


        <!-- Custom HTML head -->

        <meta name="description" content="Anki&#x27;s user manual. Anki is a flashcard program that makes learning easier.">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" id="highlight-css" href="highlight.css">
        <link rel="stylesheet" id="tomorrow-night-css" href="tomorrow-night.css">
        <link rel="stylesheet" id="ayu-highlight-css" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        <link rel="stylesheet" href="css/misc.css">
        <link rel="stylesheet" href="css/mdbook-admonish.css">

        <!-- MathJax -->
        <script async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

        <!-- Provide site root and default themes to javascript -->
        <script>
            const path_to_root = "";
            const default_light_theme = "light";
            const default_dark_theme = "navy";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="toc.js"></script>
    </head>
    <body>
    <div id="mdbook-help-container">
        <div id="mdbook-help-popup">
            <h2 class="mdbook-help-title">Keyboard shortcuts</h2>
            <div>
                <p>Press <kbd>←</kbd> or <kbd>→</kbd> to navigate between chapters</p>
                <p>Press <kbd>S</kbd> or <kbd>/</kbd> to search in the book</p>
                <p>Press <kbd>?</kbd> to show this help</p>
                <p>Press <kbd>Esc</kbd> to hide this help</p>
            </div>
        </div>
    </div>
    <div id="body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                let theme = localStorage.getItem('mdbook-theme');
                let sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            const default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? default_dark_theme : default_light_theme;
            let theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            let sidebar = null;
            const sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="toc.html"></iframe>
            </noscript>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="default_theme">Auto</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search (`/`)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="/ s" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Anki Manual</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        <a href="https://github.com/ankitects/anki-manual/" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="self-hosted-sync-server"><a class="header" href="#self-hosted-sync-server">Self-Hosted Sync Server</a></h1>
<p>Advanced users who cannot or do not wish to use AnkiWeb can use a self-hosted
sync server instead.</p>
<p>Things to be aware of:</p>
<ul>
<li>This is an advanced feature, targeted at users who are comfortable with
networking and the command line. If you use this, the expectation is you
can resolve any setup/network/firewall issues you run into yourself, and
use of this is entirely at your own risk.</li>
<li>Newer clients may depend on changes to the sync protocol, so syncing may
stop working if you update your Anki clients without also updating the server.</li>
<li>Third-party sync servers also exist. No testing is done against them, and
they tend to take time to catch up when the sync protocol changes, so they
are not recommended.</li>
<li>The messages inside Anki will use the term “AnkiWeb” even if a custom server
has been configured, (e.g “Cannot connect to AnkiWeb” when your server is down).</li>
</ul>
<h2 id="installingrunning"><a class="header" href="#installingrunning">Installing/Running</a></h2>
<p>There are various ways you can install and run the server. You can use either:</p>
<ul>
<li>the sync server bundled with the desktop version of Anki</li>
<li>a separate minimal sync server that doesn’t include Anki’s GUI dependencies. Python and Rust implementations are available.</li>
</ul>
<h3 id="from-a-packaged-build"><a class="header" href="#from-a-packaged-build">From a Packaged Build</a></h3>
<p>This uses the sync server built into the desktop version of Anki as of version 2.1.57+.</p>
<p>On Windows in a cmd.exe session:</p>
<pre><code>set SYNC_USER1=user:pass
"\Program Files\anki\anki.exe" --syncserver
</code></pre>
<p>Or MacOS, in Terminal.app:</p>
<pre><code>SYNC_USER1=user:pass /Applications/Anki.app/Contents/MacOS/anki --syncserver
</code></pre>
<p>Or Linux:</p>
<pre><code>SYNC_USER1=user:pass anki --syncserver
</code></pre>
<h3 id="with-pip"><a class="header" href="#with-pip">With Pip</a></h3>
<p>To avoid downloading desktop Anki’s GUI dependencies, you can run a standalone Anki sync server using a Python package downloaded from PyPI instead.
Make sure you have Python 3.9+ installed.</p>
<pre><code>python3 -m venv ~/syncserver
~/syncserver/bin/pip install anki
SYNC_USER1=user:pass ~/syncserver/bin/python -m anki.syncserver
</code></pre>
<h3 id="with-cargo"><a class="header" href="#with-cargo">With Cargo</a></h3>
<p>From Anki 2.1.66+, you can alternatively build a Rust implementation of the standalone sync server using the below command.
Make sure you have Rustup installed.</p>
<pre><code>cargo install --locked --git https://github.com/ankitects/anki.git --tag 25.02.5 anki-sync-server
</code></pre>
<p>Replace 25.02.5 with whatever the latest Anki version is.</p>
<p>Protobuf (protoc) will need to be installed.</p>
<p>After building, you can run it with:</p>
<pre><code>SYNC_USER1=user:pass anki-sync-server
</code></pre>
<h3 id="from-a-source-checkout"><a class="header" href="#from-a-source-checkout">From a source checkout</a></h3>
<p>If you’ve cloned the Anki repo from GitHub, you can install from there:</p>
<pre><code>./ninja extract:protoc
cargo install --path rslib/sync
</code></pre>
<h3 id="with-docker"><a class="header" href="#with-docker">With Docker</a></h3>
<p>You can find a user-contributed Dockerfile and some instructions
<a href="https://github.com/ankitects/anki/tree/main/docs/syncserver">here</a>.</p>
<h2 id="multiple-users"><a class="header" href="#multiple-users">Multiple Users</a></h2>
<p><code>SYNC_USER1</code> declares the first user and password, and must be set.
You can optionally declare <code>SYNC_USER2</code>, <code>SYNC_USER3</code> and so on, if you
wish to set up multiple accounts.</p>
<h2 id="hashed-passwords"><a class="header" href="#hashed-passwords">Hashed Passwords</a></h2>
<p>Advanced users may wish to use hashed passwords instead of plain text
passwords. If you wish to do this, you’ll need to use a separate tool (such as
<a href="https://git.sr.ht/~laalsaas/pbkdf2-password-hash">this one</a>) to generate a
password hash.  You can then tell the server to expect hashed passwords by
setting the env var PASSWORDS_HASHED to 1 (or any other value).</p>
<p>When hashed passwords are used, SYNC_USER variables are expected to be in
username:password_hash format, where password_hash is a hash of the password in
the PHC Format.</p>
<h2 id="storage-location"><a class="header" href="#storage-location">Storage Location</a></h2>
<p>The server needs to store a copy of your collection and media in a folder.
By default it is ~/.syncserver; you can change this by defining
a <code>SYNC_BASE</code> environmental variable.</p>
<ul>
<li>This must not be the same location as your normal Anki data folder, as the
server and client must store separate copies.</li>
<li>You must sync your data to the server, not manually copy files into the
server folder.</li>
</ul>
<h2 id="public-access"><a class="header" href="#public-access">Public Access</a></h2>
<p>The server listens on an unencrypted HTTP connection, so it’s not a good
idea to expose it directly to the internet. You’ll want to either restrict
usage to your local network, or place some form of encryption in front of
the server, such as a VPN (Tailscale is apparently easy), or a HTTPS
reverse proxy.</p>
<p>You can define <code>SYNC_HOST</code> and <code>SYNC_PORT</code> to change the host and port
that the server binds to.</p>
<h2 id="client-setup"><a class="header" href="#client-setup">Client Setup</a></h2>
<p>You’ll need to determine your computer’s network IP address, and then
point each of your Anki clients to the address, e.g something like
<code>http://192.168.1.200:8080/</code>. The URL can be configured in the preferences.</p>
<p>If you’re using AnkiMobile and are unable to connect to a server on your local
network, please go into the iOS settings, locate Anki near the bottom, and
toggle “Allow Anki to access local network” off and then on again.</p>
<p>Older desktop clients required you to define <code>SYNC_ENDPOINT</code> and
<code>SYNC_ENDPOINT_MEDIA</code>.  If using an older client, you’d put it as e.g.
<code>http://192.168.1.200:8080/sync/</code> and <code>http://192.168.1.200:8080/msync/</code>
respectively. AnkiDroid clients before 2.16 require separate configuration for
the two endpoints.</p>
<h2 id="reverse-proxies"><a class="header" href="#reverse-proxies">Reverse Proxies</a></h2>
<p>If using a reverse proxy to provide HTTPS access (e.g. nginx), and binding to a subpath
(e.g. <code>http://example.com/custom/</code> -&gt; <code>http://localhost:8080/</code>), you must make sure to
including a trailing slash when configuring Anki. If you put <code>http://example.com/custom</code>
instead, it will not work.</p>
<p>On iOS, TLS 1.3 is not supported, so your reverse proxy will need to have TLS 1.2
enabled, or you’ll get an “error code -9836”.</p>
<h2 id="large-requests"><a class="header" href="#large-requests">Large Requests</a></h2>
<p>The standard AnkiWeb limit on uploads is applied by default. You can optionally
set <code>MAX_SYNC_PAYLOAD_MEGS</code> to something greater than 100 if you wish to
increase the limit. Bear in mind that if you’re using a reverse proxy, you may
need to adjust the limit there as well.</p>
<h2 id="contributing-changes"><a class="header" href="#contributing-changes">Contributing Changes</a></h2>
<p>Because this server is bundled with Anki, simplicity is a design goal - it is
targeted at individual/family use, and PRs that add things like a REST API or
external databases are unlikely to be accepted at this time. If in doubt, please
reach out before starting work on a PR.</p>
<p>If you’re looking for an existing API solution, the AnkiConnect add-on may
meet your needs.</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="troubleshooting.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="misc.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="troubleshooting.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="misc.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="elasticlunr.min.js"></script>
        <script src="mark.min.js"></script>
        <script src="searcher.js"></script>

        <script src="clipboard.min.js"></script>
        <script src="highlight.js"></script>
        <script src="book.js"></script>

        <!-- Custom JS scripts -->


    </div>
    </body>
</html>
